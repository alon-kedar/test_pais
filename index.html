<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lottery Score Widget</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
</head>
<body>
<div class="lottery-widget">
    <h2>Lottery Score</h2>
    <label for="lottery-date">Select Date:</label>
    <select id="lottery-date">
    </select>
    <div id="lottery-result">
        <p>Select a date to view the lottery score.</p>
    </div>
    <div id="strong-number"></div>
</div>
</body>
</html>

<script>
    $(document).ready(function () {
        $(document).ready(function () {
            let lotteryData = []

            const lotteryResultDiv = document.getElementById('lottery-result');
            const lotteryDateSelect = document.getElementById('lottery-date');
            const lotteryStrongResultDiv = document.getElementById('strong-number');

            lotteryDateSelect.addEventListener('change', function() {
                const selectedDate = lotteryDateSelect.value;
                console.log({selectedDate})
                console.log({lotteryData})
                const result = lotteryData.find(data => data.saleDate === selectedDate);

                console.log({result})
                if (result) {
                    lotteryResultDiv.innerHTML = `<p>Lottery Score: <strong>${result.winNumbers}</strong></p>`;
                    lotteryStrongResultDiv.innerHTML = `<p>Strong Number: <strong>${result.strongNumber}</strong></p>`
                } else {
                    lotteryResultDiv.innerHTML = "<p>No results available for this date.</p>";
                }
            });

            $.ajax({
                type: "get",
                url: "https://script.google.com/macros/s/AKfycbyd4wiOitqFuRLXL3Eo9ND-4-9AZjVAvA5cQ8p86oQ9NwKNiuPSdIE1vCdXZLyHIvNp/exec?callback=?",
                data: {method: "getQuote", format: "jsonp", lang: "en"},
                dataType: "jsonp",
                jsonp: "jsonp",
                jsonpCallback: "myJsonMethod"
            });
            window.myJsonMethod = function (results) {
                lotteryData.push(...results)
                lotteryData.forEach(function (data) {
                    const option = document.createElement('option');
                    option.value = data.saleDate;
                    option.textContent = data.saleDate;
                    lotteryDateSelect.appendChild(option);
                });

                lotteryData.forEach(function (data) {
                    const option = document.createElement('option');
                    option.value = data.date;
                    option.textContent = data.date;
                    lotteryDateSelect.appendChild(option);
                })
                lotteryDateSelect.dispatchEvent(new Event('change'));
            }
        })
    })


    // function getResults(html) {
    //
    //     let dom_nodes = $($.parseHTML(html))
    //
    //     var elements = dom_nodes.find(".archive_list_item");
    //
    //
    //     // return $.map($(elements), e => ({
    //     //     saleNumber: $($(e).find(".archive_list_block.lotto_number").first().children()[2]).text(),
    //     //     saleDate: $($(e).find(".archive_list_block.date").first().children()[2]).text(),
    //     //     winNumbers: $.map($(elements.find(".loto_info_num.archive")), e => $($(e).children()[0]).text()),
    //     //     strongNumber: $(elements.find(".loto_info_num.strong.archive").first().children()[1]).text()
    //     // }))
    // }
</script>

